<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heartfelt Appreciation Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6c5ce7;
            --secondary: #a29bfe;
            --accent: #fd79a8;
            --text: #2d3436;
            --light: #f5f6fa;
            --dark: #1a1a2e;
            --success: #00b894;
            --warning: #fdcb6e;
            --error: #d63031;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            height: 100%;
            font-family: 'Poppins', sans-serif;
            overflow: hidden;
            background: var(--light);
            touch-action: manipulation;
        }

        /* Splash Screen Styles */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: all 1s cubic-bezier(0.86, 0, 0.07, 1);
            padding: 20px;
            overflow: hidden;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 0;
        }

        .shape {
            position: absolute;
            opacity: 0.1;
            animation: float-shapes 15s linear infinite;
        }

        @keyframes float-shapes {
            0% { transform: translateY(100vh) rotate(0deg); }
            100% { transform: translateY(-100px) rotate(360deg); }
        }

        .splash-header {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 1rem;
            text-shadow: 0 2px 5px rgba(0,0,0,0.2);
            opacity: 0.8;
            letter-spacing: 1px;
            text-align: center;
            width: 100%;
            padding: 0 20px;
            z-index: 2;
        }

        .splash-content {
            text-align: center;
            color: white;
            width: 100%;
            max-width: 600px;
            margin-top: 40px;
            position: relative;
            z-index: 2;
        }

        .title {
            font-size: clamp(2.5rem, 8vw, 4rem);
            margin-bottom: 1.5rem;
            font-weight: 700;
            text-shadow: 0 5px 15px rgba(0,0,0,0.2);
            animation: float 3s ease-in-out infinite;
            position: relative;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: white;
            border-radius: 3px;
            animation: pulseLine 2s infinite;
        }

        @keyframes pulseLine {
            0% { width: 80px; opacity: 1; }
            50% { width: 120px; opacity: 0.5; }
            100% { width: 80px; opacity: 1; }
        }

        .selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            width: 100%;
            margin-top: 20px;
        }

        .person-btn {
            padding: 12px 15px;
            border: none;
            border-radius: 50px;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            color: white;
            font-size: clamp(1rem, 4vw, 1.2rem);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            z-index: 1;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .person-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(255,255,255,0.2), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
            z-index: -1;
        }

        .person-btn:hover {
            transform: translateY(-3px) scale(1.03);
            background: rgba(255,255,255,0.25);
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
        }

        .person-btn:hover::before {
            transform: translateX(100%);
        }

        .person-btn i {
            margin-right: 8px;
            font-size: 1.1em;
        }

        /* Main Content Styles */
        .main-content {
            display: none;
            position: relative;
            width: 100%;
            height: 100%;
            overflow: auto;
            -webkit-overflow-scrolling: touch;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background: rgba(255,255,255,0.6);
            border-radius: 50%;
        }

        .message-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100%;
            padding: 30px 20px;
            text-align: center;
        }

        .message-box {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(15px);
            padding: 30px 25px;
            border-radius: 20px;
            width: 100%;
            max-width: 700px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            transform: scale(0.9);
            opacity: 0;
            animation: messageAppear 0.8s forwards 0.3s;
            position: relative;
            overflow: hidden;
            margin: 20px 0;
            border: 1px solid rgba(255,255,255,0.3);
        }

        @keyframes messageAppear {
            to { transform: scale(1); opacity: 1; }
        }

        .message-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(to bottom, var(--accent), var(--primary));
        }

        .person-name {
            font-size: clamp(2rem, 8vw, 3rem);
            margin-bottom: 15px;
            color: var(--primary);
            font-weight: 800;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1.2;
            font-family: 'Dancing Script', cursive, sans-serif;
        }

        .appreciation-message {
            font-size: clamp(1rem, 4vw, 1.2rem);
            line-height: 1.8;
            color: var(--text);
            margin-bottom: 20px;
        }

        .signature {
            font-style: italic;
            color: var(--accent);
            font-weight: 600;
            margin-top: 20px;
            font-size: clamp(0.9rem, 3vw, 1.1rem);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .signature::before {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(to right, transparent, var(--accent));
            margin-right: 15px;
        }

        .signature::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(to left, transparent, var(--accent));
            margin-left: 15px;
        }

        .floating-hearts {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: -1;
        }

        .heart {
            position: absolute;
            opacity: 0;
            font-size: 18px;
            color: var(--accent);
            animation: float-up 5s linear forwards;
            z-index: -1;
        }

        @keyframes float-up {
            0% { transform: translateY(100vh) scale(0) rotate(0deg); opacity: 0; }
            10% { opacity: 0.8; }
            90% { opacity: 0.8; }
            100% { transform: translateY(-100px) scale(1) rotate(360deg); opacity: 0; }
        }

        .back-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .back-btn:hover {
            transform: translateY(-3px) scale(1.05);
            background: var(--accent);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .photo-frame {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            border: 5px solid white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            overflow: hidden;
            position: relative;
            background: #f5f6fa;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .photo-frame i {
            font-size: 3rem;
            color: var(--primary);
        }

        .achievement-badges {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .badge {
            background: linear-gradient(45deg, var(--primary), var(--accent));
            color: white;
            padding: 5px 12px;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }

        /* Reaction Styles */
        .reaction-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .reaction-btn {
            background: rgba(255,255,255,0.8);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }

        .reaction-btn:hover {
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
        }

        .reaction-btn.selected {
            transform: scale(1.1);
            box-shadow: 0 0 0 2px var(--accent);
        }

        .reaction-count {
            font-size: 0.7rem;
            margin-top: 3px;
            color: var(--text);
            opacity: 0.8;
        }

        .reaction-feedback {
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--accent);
            font-weight: 600;
            height: 20px;
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .selector {
                grid-template-columns: 1fr;
            }
            
            .person-btn {
                padding: 12px 15px;
            }
            
            .message-box {
                padding: 25px 20px;
            }
            
            .back-btn {
                width: 45px;
                height: 45px;
                font-size: 1.1rem;
            }

            .photo-frame {
                width: 100px;
                height: 100px;
            }
        }

        @media (max-width: 400px) {
            .photo-frame {
                width: 80px;
                height: 80px;
            }
            
            .person-btn i {
                display: none;
            }
            
            .reaction-btn {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div class="splash-screen" id="splashScreen">
        <div class="floating-shapes" id="floatingShapes"></div>
        <div class="splash-header">Made with ❤️ by TARTIL</div>
        <div class="splash-content">
            <h1 class="title">Who Are You?</h1>
            <div class="selector">
                <button class="person-btn" data-person="ashim"><i class="fas fa-chalkboard-teacher"></i>Ashim Sir</button>
                <button class="person-btn" data-person="tanvir"><i class="fas fa-brain"></i>Tanvir</button>
                <button class="person-btn" data-person="surjo"><i class="fas fa-lightbulb"></i>Surjo</button>
                <button class="person-btn" data-person="protik"><i class="fas fa-laugh-beam"></i>Protik</button>
                <button class="person-btn" data-person="nabila"><i class="fas fa-book-open"></i>Nabila</button>
                <button class="person-btn" data-person="mridu"><i class="fas fa-palette"></i>Mridu</button>
                <button class="person-btn" data-person="maya"><i class="fas fa-tasks"></i>Maya</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="particles" id="particles"></div>
        <div class="floating-hearts" id="hearts"></div>
        <div class="message-container">
            <div class="message-box">
                <div class="photo-frame" id="photoFrame">
                    <i class="fas fa-user" id="personIcon"></i>
                </div>
                <h2 class="person-name" id="personName">Person's Name</h2>
                <div class="achievement-badges" id="achievementBadges"></div>
                <p class="appreciation-message" id="appreciationMessage">Your personalized message will appear here.</p>
                
                <!-- Reaction Section -->
                <div class="reaction-container" id="reactionContainer">
                    <!-- Reactions will be added here dynamically -->
                </div>
                <div class="reaction-feedback" id="reactionFeedback"></div>
                
                <p class="signature">Made with appreciation</p>
            </div>
        </div>
        <button class="back-btn" id="backBtn" title="Back to selection"><i class="fas fa-arrow-left"></i></button>
    </div>

    <script>
        // Enhanced data for each person
        const personData = {
            ashim: {
                name: "Ashim Sir",
                message: "Dear Ashim Sir, your wisdom and patience have shaped not just our knowledge but our character. The way you simplify complex concepts is nothing short of magical. You're not just a teacher, but a mentor who inspires us to reach beyond what we thought possible. Thank you for your unwavering dedication.",
                color: ["#1a2980", "#26d0ce"],
                icon: "fa-chalkboard-teacher",
                badges: ["Best Teacher", "Knowledge Guru", "Patient Mentor"],
                emoji: "👨‍🏫"
            },
            tanvir: {
                name: "Tanvir",
                message: "Tanvir, your brilliant mind and quick wit make every study session enjoyable. You have this incredible ability to explain things in ways that just click. Your dedication to helping others understand difficult topics is truly admirable. The class wouldn't be the same without your insightful contributions!",
                color: ["#ff758c", "#ff7eb3"],
                icon: "fa-brain",
                badges: ["Quick Thinker", "Problem Solver", "Team Player"],
                emoji: "🧠"
            },
            surjo: {
                name: "Surjo",
                message: "Surjo, your quiet determination and sharp intellect are truly inspiring. You approach every challenge with such thoughtfulness and depth. I admire how you never give up until you fully understand something. Your perseverance motivates everyone around you to try harder and think deeper.",
                color: ["#11998e", "#38ef7d"],
                icon: "fa-lightbulb",
                badges: ["Deep Thinker", "Persistent Learner", "Focused"],
                emoji: "💡"
            },
            protik: {
                name: "Protik",
                message: "Protik, your energy and humor bring so much life to our class! You have this unique talent for finding creative solutions to problems that leave the rest of us amazed. Even when topics get tough, your positive attitude keeps everyone motivated. Thanks for making learning fun!",
                color: ["#654ea3", "#eaafc8"],
                icon: "fa-laugh-beam",
                badges: ["Class Clown", "Creative Mind", "Energy Booster"],
                emoji: "😄"
            },
            nabila: {
                name: "Nabila",
                message: "Nabila, your attention to detail and thorough understanding of concepts is remarkable. Your notes are legendary! But more than that, I appreciate your willingness to help others without hesitation. Your kindness and intelligence make you such a valuable member of our class.",
                color: ["#f12711", "#f5af19"],
                icon: "fa-book-open",
                badges: ["Note Queen", "Detail Oriented", "Helpful"],
                emoji: "📚"
            },
            mridu: {
                name: "Mridu",
                message: "Mridu, your artistic approach to learning turns even the driest subjects into something beautiful. I'm constantly amazed by how you visualize complex ideas. Your unique perspective adds so much depth to our discussions. Keep sharing your creative way of seeing the world!",
                color: ["#8e2de2", "#4a00e0"],
                icon: "fa-palette",
                badges: ["Creative Soul", "Visual Learner", "Artistic"],
                emoji: "🎨"
            },
            maya: {
                name: "Maya",
                message: "Maya, your organizational skills and ability to break down complex topics are incredible. You have this gift for identifying the core of any problem. Your thoughtful questions often lead to discussions that help everyone understand better. Thank you for being such an engaged and insightful classmate!",
                color: ["#00b09b", "#96c93d"],
                icon: "fa-tasks",
                badges: ["Organized", "Analytical", "Insightful"],
                emoji: "📊"
            }
        };

        // Reaction options
        const reactionOptions = [
            { emoji: "❤️", name: "love" },
            { emoji: "👍", name: "thumbs-up" },
            { emoji: "😊", name: "smile" },
            { emoji: "👏", name: "clap" },
            { emoji: "🙏", name: "thanks" }
        ];

        // GitHub Storage Setup - CONFIGURED WITH YOUR DETAILS
        const GITHUB_USERNAME = "tartilhossain";
        const GITHUB_REPO = "tartilhossain.github.io";
        const GITHUB_TOKEN = "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";
        const STORAGE_FILE = "reactions.json";
        
        // Store reactions locally until we can save to GitHub
        let localReactions = {};
        let currentPerson = null;
        let selectedReaction = null;

        // DOM elements
        const splashScreen = document.getElementById('splashScreen');
        const mainContent = document.getElementById('mainContent');
        const backBtn = document.getElementById('backBtn');
        const personName = document.getElementById('personName');
        const appreciationMessage = document.getElementById('appreciationMessage');
        const particlesContainer = document.getElementById('particles');
        const heartsContainer = document.getElementById('hearts');
        const floatingShapes = document.getElementById('floatingShapes');
        const photoFrame = document.getElementById('photoFrame');
        const personIcon = document.getElementById('personIcon');
        const achievementBadges = document.getElementById('achievementBadges');
        const reactionContainer = document.getElementById('reactionContainer');
        const reactionFeedback = document.getElementById('reactionFeedback');
        
        // Animation variables
        let heartInterval;
        let shapeInterval;

        // Initialize floating shapes
        createFloatingShapes();

        // Set up event listeners
        document.querySelectorAll('.person-btn').forEach(button => {
            button.addEventListener('click', function() {
                const person = this.getAttribute('data-person');
                showAppreciation(person);
            });
        });

        backBtn.addEventListener('click', returnToSplash);

        // Handle window resize
        window.addEventListener('resize', function() {
            if (currentPerson && mainContent.style.display === 'block') {
                createParticles();
            }
            createFloatingShapes();
        });

        // Load reactions from GitHub when page loads
        window.addEventListener('load', loadReactions);

        function showAppreciation(person) {
            currentPerson = person;
            const data = personData[person];
            
            // Animate splash screen exit
            splashScreen.style.opacity = '0';
            splashScreen.style.transform = 'scale(1.1)';
            
            setTimeout(() => {
                // Hide splash screen
                splashScreen.style.display = 'none';
                
                // Show main content
                mainContent.style.display = 'block';
                
                // Set background gradient
                document.body.style.background = `linear-gradient(135deg, ${data.color[0]}, ${data.color[1]})`;
                
                // Set person details
                personName.textContent = data.name;
                appreciationMessage.textContent = data.message;
                personIcon.className = `fas ${data.icon}`;
                
                // Set achievement badges
                achievementBadges.innerHTML = '';
                data.badges.forEach(badge => {
                    const badgeElement = document.createElement('div');
                    badgeElement.className = 'badge';
                    badgeElement.textContent = badge;
                    achievementBadges.appendChild(badgeElement);
                });
                
                // Create animations
                createParticles();
                startHearts();
                
                // Set up reactions
                setupReactions(person);
            }, 800);
        }

        function returnToSplash() {
            // Clear animations
            clearInterval(heartInterval);
            heartsContainer.innerHTML = '';
            particlesContainer.innerHTML = '';
            
            // Hide main content
            mainContent.style.display = 'none';
            
            // Show splash screen
            splashScreen.style.display = 'flex';
            setTimeout(() => {
                splashScreen.style.opacity = '1';
                splashScreen.style.transform = 'scale(1)';
            }, 50);
        }

        function createFloatingShapes() {
            floatingShapes.innerHTML = '';
            const shapeCount = Math.min(Math.floor(window.innerWidth / 20), 20);
            const shapes = ['circle', 'square', 'triangle'];
            
            for (let i = 0; i < shapeCount; i++) {
                const shape = document.createElement('div');
                shape.classList.add('shape');
                
                // Random properties
                const size = Math.random() * 100 + 50;
                const posX = Math.random() * window.innerWidth;
                const delay = Math.random() * 15;
                const duration = Math.random() * 20 + 15;
                const shapeType = shapes[Math.floor(Math.random() * shapes.length)];
                const color = `hsla(${Math.random() * 360}, 70%, 70%, 0.1)`;
                
                // Apply styles
                shape.style.width = `${size}px`;
                shape.style.height = `${size}px`;
                shape.style.left = `${posX}px`;
                shape.style.animationDuration = `${duration}s`;
                shape.style.animationDelay = `${delay}s`;
                shape.style.backgroundColor = color;
                
                // Shape specific styles
                if (shapeType === 'circle') {
                    shape.style.borderRadius = '50%';
                } else if (shapeType === 'triangle') {
                    shape.style.width = '0';
                    shape.style.height = '0';
                    shape.style.backgroundColor = 'transparent';
                    shape.style.borderLeft = `${size/2}px solid transparent`;
                    shape.style.borderRight = `${size/2}px solid transparent`;
                    shape.style.borderBottom = `${size}px solid ${color}`;
                }
                
                floatingShapes.appendChild(shape);
            }
        }

        function createParticles() {
            particlesContainer.innerHTML = '';
            const particleCount = Math.min(Math.floor(window.innerWidth / 5), 100);
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                
                // Random properties
                const size = Math.random() * 4 + 1;
                const posX = Math.random() * window.innerWidth;
                const posY = Math.random() * window.innerHeight;
                const opacity = Math.random() * 0.6 + 0.1;
                const animationDuration = Math.random() * 15 + 10;
                const delay = Math.random() * 5;
                
                // Apply styles
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${posX}px`;
                particle.style.top = `${posY}px`;
                particle.style.opacity = opacity;
                particle.style.animation = `float-particle ${animationDuration}s linear ${delay}s infinite`;
                
                // Add to container
                particlesContainer.appendChild(particle);
            }
            
            // Add animation to CSS if not already present
            if (!document.getElementById('particle-animation')) {
                const style = document.createElement('style');
                style.id = 'particle-animation';
                style.innerHTML = `
                    @keyframes float-particle {
                        0% { transform: translateY(0) translateX(0); opacity: ${Math.random() * 0.6 + 0.1}; }
                        50% { transform: translateY(-80px) translateX(10px); }
                        100% { transform: translateY(-160px) translateX(0); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        function startHearts() {
            // Clear any existing interval
            clearInterval(heartInterval);
            heartsContainer.innerHTML = '';
            
            heartInterval = setInterval(() => {
                if (mainContent.style.display !== 'block') {
                    clearInterval(heartInterval);
                    return;
                }
                
                const heart = document.createElement('div');
                heart.classList.add('heart');
                heart.innerHTML = ['❤️', '🧡', '💛', '💚', '💙', '💜', '🤎', '🖤', '🤍'][Math.floor(Math.random() * 9)];
                
                // Random properties
                const posX = Math.random() * window.innerWidth;
                const duration = Math.random() * 3 + 3;
                const size = Math.random() * 0.7 + 0.5;
                const rotation = Math.random() * 360;
                
                // Apply styles
                heart.style.left = `${posX}px`;
                heart.style.bottom = '-20px';
                heart.style.animationDuration = `${duration}s`;
                heart.style.transform = `scale(${size}) rotate(${rotation}deg)`;
                
                heartsContainer.appendChild(heart);
                
                // Remove heart after animation
                setTimeout(() => {
                    if (heart.parentNode === heartsContainer) {
                        heart.remove();
                    }
                }, duration * 1000);
            }, 300);
        }

        // Reaction Functions
        function setupReactions(person) {
            reactionContainer.innerHTML = '';
            selectedReaction = null;
            reactionFeedback.textContent = '';
            
            reactionOptions.forEach(reaction => {
                const reactionBtn = document.createElement('button');
                reactionBtn.className = 'reaction-btn';
                reactionBtn.innerHTML = `${reaction.emoji}`;
                reactionBtn.title = reaction.name;
                reactionBtn.dataset.reaction = reaction.name;
                
                // Show count if available
                const count = localReactions[person]?.[reaction.name] || 0;
                if (count > 0) {
                    const countElement = document.createElement('div');
                    countElement.className = 'reaction-count';
                    countElement.textContent = count;
                    reactionBtn.appendChild(countElement);
                }
                
                reactionBtn.addEventListener('click', () => handleReaction(person, reaction.name));
                reactionContainer.appendChild(reactionBtn);
            });
        }

        function handleReaction(person, reactionName) {
            // Update UI immediately
            const reactionBtns = document.querySelectorAll('.reaction-btn');
            reactionBtns.forEach(btn => {
                btn.classList.remove('selected');
                if (btn.dataset.reaction === reactionName) {
                    btn.classList.add('selected');
                }
            });
            
            // Check if this is a new reaction or changing reaction
            if (selectedReaction === reactionName) {
                // They're clicking the same reaction again (undo)
                selectedReaction = null;
                reactionFeedback.textContent = 'Reaction removed';
                setTimeout(() => { reactionFeedback.textContent = ''; }, 2000);
                
                // Decrement count locally
                if (localReactions[person]?.[reactionName]) {
                    localReactions[person][reactionName]--;
                    if (localReactions[person][reactionName] <= 0) {
                        delete localReactions[person][reactionName];
                    }
                }
            } else {
                // They're selecting a new reaction
                if (selectedReaction) {
                    // Remove previous reaction count
                    if (localReactions[person]?.[selectedReaction]) {
                        localReactions[person][selectedReaction]--;
                        if (localReactions[person][selectedReaction] <= 0) {
                            delete localReactions[person][selectedReaction];
                        }
                    }
                }
                
                selectedReaction = reactionName;
                reactionFeedback.textContent = 'Thanks for your reaction!';
                setTimeout(() => { reactionFeedback.textContent = ''; }, 2000);
                
                // Increment count locally
                if (!localReactions[person]) {
                    localReactions[person] = {};
                }
                if (!localReactions[person][reactionName]) {
                    localReactions[person][reactionName] = 0;
                }
                localReactions[person][reactionName]++;
            }
            
            // Update the UI counts
            setupReactions(person);
            
            // Save to GitHub
            saveReactions();
        }

        // GitHub Storage Functions
        async function loadReactions() {
            try {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/${STORAGE_FILE}`, {
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const content = atob(data.content);
                    localReactions = JSON.parse(content) || {};
                } else {
                    console.log('No existing reactions file found, starting fresh');
                    localReactions = {};
                }
            } catch (error) {
                console.error('Error loading reactions:', error);
                localReactions = {};
            }
        }

        async function saveReactions() {
            try {
                // First get the current file to get its SHA (required for update)
                let sha = null;
                try {
                    const getResponse = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/${STORAGE_FILE}`, {
                        headers: {
                            'Authorization': `token ${GITHUB_TOKEN}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (getResponse.ok) {
                        const data = await getResponse.json();
                        sha = data.sha;
                    }
                } catch (e) {
                    // File may not exist yet, that's fine
                }
                
                // Prepare the request
                const content = btoa(JSON.stringify(localReactions, null, 2));
                const message = 'Update reactions';
                
                const response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/${STORAGE_FILE}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message,
                        content,
                        sha: sha || undefined
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to save reactions');
                }
                
                console.log('Reactions saved successfully');
            } catch (error) {
                console.error('Error saving reactions:', error);
                // You might want to implement a retry mechanism or local storage fallback here
            }
        }
    </script>
</body>
  </html>
